\subsection{Weak Bisimulation of Asynchronous Discrete Networks}
\label{sec:dn}

We exhibit an encoding of Asynchronous Discrete Networks (ADN) with the Process
Hitting using two classes of priorities
that respects all Conditions of \pref{ssec:hypothesis},
and prove a weak bisimulation relation.

A Discrete Network gathers a finite number of components $i\in\segm{1}{n}$ having a discrete finite domain
$\mathbb F^i$ that we note $\mathbb{F}^i = \segm{1}{l_i}$.
For each component $i\in\segm{1}{n}$, a map $\mathbb F \rightarrow \mathbb F^i$ is defined, where
$\mathbb F = \mathbb F^1 \times \cdots \times \mathbb F^n$, giving the next value of the component
with respect to the global state of the network.
Typically $f^i$ depends on a subset of components that we denote $\DNdep(f^i)$.
In the case of Asynchronous Discrete Networks (ADN), a transition relation $\DNtrans\subseteq \mathbb
F\times \mathbb F$ is defined such that $x\DNtrans x'$ if and only if there exists a unique
$i\in\segm{1}{n}$ such that $\get{x'}{i}=f^i(x)$ and $\forall j\in\segm{1}{n}, j\neq i, \get{x'}{j}
=\get{x}{j}$, \ie one and only one component has been updated.
This is formalised in \pref{def:DN}.

\begin{definition}[Asynchronous Discrete Network (ADN)]
\label{def:DN}
  An ADN is defined by a couple $(\mathbb F, \langle f^1, \dots, f^n \rangle)$
  where $\mathbb{F} = \mathbb{F}^1\times\dots\times\mathbb{F}^n$,
  and $\forall i\in\segm{1}{n}$,
  $f^i: \mathbb{F} \rightarrow \mathbb{F}^i$ with
  $\mathbb{F}^i = \segm{1}{l_i}$.
  Given two states $x,x'\in\mathbb F$, the transition relation $\DNtrans$ is given by
  \[
  x\DNtrans x' \Longleftrightarrow
    \exists i\in\segm{1}{n}, f^i(x)=\get{x'}{i}
    \wedge \forall j\in\segm{1}{n}, j\neq i, \get{x}{j}=\get{x'}{j}
  \enspace,
  \]
  where $\get{x}{i}$ is the $i$-th component of $x$.
  %
  We note $\DNdep(f^i)\subseteq \segm{1}{n}$ the set of components on which the value of $f^i$
  depends: $\forall x,x'\in \mathbb F$ such that $\forall
  j\in\DNdep(f^i), \get{x}{j}=\get{x'}{j}$, necessarily $f^i(x)=f^i(x')$.
\end{definition}

Let us denote the encoding of the ADN $\DNdef$ in Process Hitting with $2$ classes
of priorities by $\toPH\DNdef$ (\pref{def:DN2PH}).
For each component $i\in\segm{1}{n}$ of the ADN, two sorts are built: $a^i$ acting for the component
value, and $f^i$ acting for a cooperative sort between the components $\DNdep(f^i)$.
Sorts $a^i$ have one process $a^i_k$ per element in $k\in\mathbb F^i$.
Sorts $f^i$ have one process $f^i_\varsigma$ per state $\varsigma \in \underset{j\in\DNdep(f^i)}{\times}
\PHl_{a^j}$.
Two classes of actions are then defined:
$\Hits^{(1)}$ is the set of actions updating the cooperative sorts according to the current state of the
components:
if $j\in\DNdep(f^i)$, $a^j_k$ hits each process $f^i_\varsigma$ where $\get{\varsigma}{a^j}\neq
a^j_k$ to make it bounce to the process $f^i_{\varsigma \Cap a^j_k}$.
$\Hits^{(2)}$ is the set of actions encoding the transitions in the ADN:
$f^i_\varsigma$ hits the processes of sort $a^i$ to make them bounce to the process
$a^i_{k'}$ if and only if $k'=f^i(\decode \varsigma)$;
$\decode \varsigma$ being the ADN state corresponding to the PH (partial) state $\varsigma$ (note that
$f^i(\decode \varsigma)$ is fully defined because $\decode \varsigma$ specifies the state for all
the components in $\DNdep(f^i)$).

\begin{definition}
\label{def:DN2PH}
  $\toPH\DNdef=(\Sigma,\PHl,(\Hits^{(1)},\Hits^{(2)}))$ is the Process Hitting with 2 classes of priority encoding the
  ADN $\DNdef$, with:
  \begin{itemize}
    \item $\Sigma = \{ a^1, \dots, a^n \} \cup \{ f^1, \dots, f^n \}$,
      the sorts for components ($a^i$) and cooperative sorts ($f^i$);

    \item $\PHl=\underset{i\in\segm{1}{n}}{\times} \PHl_{a^i} \times \underset{i\in\segm{1}{n}}{\times} \PHl_{f^i}$, where
      $\PHl_{a^i}=\{a^i_0, \dots, a^i_{l_i}\}$, and
      $\PHl_{f^i}=\{f^i_\varsigma \mid \varsigma\in\underset{j\in\DNdep(f^i)}{\times} \PHl_{a^i} \}$
      if $\DNdep(f^i)\neq\emptyset$, otherwise
      $\PHl_{f^i}=\{f^i_\emptyset\}$;
      
    \item $\Hits^{(1)}= \{ \hit{a^j_k}{f^i_\varsigma}{f^i_{\varsigma'}}
      \mid i\in\segm{1}{n} \wedge
      j\in\DNdep(f^i) \wedge a^j_k\in \PHl_{a^j} \wedge f^i_\varsigma\in \PHl_{f^i}
      \wedge
      \get{\varsigma}{a^j}\neq a^j_k 
      \wedge \get{\varsigma'}{a^j}=a^j_k
      \wedge (\get{\varsigma'}{a^{l}}=\get{\varsigma}{a^l},
      \forall l\in\segm{1}{n},l\neq j)
      \}$, 
      the set of actions with priority $1$ that update cooperative sorts;

    \item $\Hits^{(2)}=\{ \hit{f^i_\varsigma}{a^i_k}{a^i_{k'}} \mid i\in\segm{1}{n} \wedge
          f^i_\varsigma\in \PHl_{f^i} \wedge
          a^i_k\in \PHl_{a^i}\wedge k\neq k' \wedge f^i(\decode \varsigma) = k'
        \}$,
      the set of actions with priority $2$ for updating the components using their respective discrete
      maps.
      $\decode \varsigma$ is defined below.
  \end{itemize}
  Given a state $s\in \PHl$ of the Process Hitting, 
  $\decode s=x$ is the corresponding state in the ADN:
  $\forall i\in\segm{1}{n}, \get{s}{a^i}=a^i_k \Rightarrow \get{x}{i}=k$.

  \noindent
  Given a state $x\in \mathbb F$ of the ADN, 
  $\encode x=s$ is the corresponding state in the Process Hitting:
  $\forall i\in\segm{1}{n}, \get{x}{i}=k \Rightarrow \get{s}{a^i}=a^i_k$
  and
  $\forall i\in\segm{1}{n}, \get{s}{f^i}=f^i_\varsigma$ with $f^i_\varsigma\in \PHl_{f^i}$
  and $\forall j\in\DNdep(f^i), \get{\varsigma}{j}=\get{s}{a^j}$.
\end{definition}

By construction, the cooperative sorts are well-formed, hence $\toPH\DNdef$
satisfies the Conditions of \pref{ssec:hypothesis}.
\pref{th:bisimDN} states the weak bisimulation relation between an ADN and its encoding in
PH with $2$ classes of priorities.
Intuitively, actions updating cooperative sorts being prioritised, actions updating component
sorts follow strictly the possible transitions of the ADN.
A detailed proof is given in \pref{suppl:proofbisimADN}.

\begin{theorem}[$\DNdef \approx \toPH\DNdef$]~
\label{th:bisimDN}
  \begin{enumerate}
    \item \label{adn2ph} $\forall x,x'\in\mathbb F$,
      $x\DNtrans x' \Longrightarrow \encode x \PHPtrans^* \encode{x'}$,
      where $\PHPtrans^*$ is a finite sequence of $\PHPtrans$ transitions.

    \item \label{ph2adn} $\forall s,s'\in \PHl$,
      $s\PHPtrans s' \Longrightarrow \decode s = \decode {s'} \vee \decode s \DNtrans
      \decode{s'}\enspace.$
  \end{enumerate}
\end{theorem}
