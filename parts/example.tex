% vim:set spell spelllang=en:

\section{Biological Examples}\label{sec:example}

\subsection{Flattening of a model: Metazoan segmentation}

In this section, we illustrate the flattening method presented in \pref{ssec:flattening}
on a model of metazoan segmentation inspired from a first translation to Process Hitting given in \cite{PMR10-TCSB}.
This model was originally established in silico in \cite{MSB:MSB4100192} in a differential equations framework.
It is composed of a wavefront gene $f$ that activates the gap-gene $a$ whose products are responsible for stripes formation.
Gene $f$ also activates a gene $c$ whose products represses the gene $a$.
The auto-inhibition of $c$ generalises a chain of repressors on $a$.
The auto-inhibition of $f$, which terminates the stripes formation in the original model,
has been removed in order to focus on the stationary dynamics of the model.

The actions of the original model make $3$ classes of priorities, as represented in \pref{fig:metazoan-php}
and listed in \pref{tab:metazoan-php-actions}.
Thus, although the actions of the highest class of priority are only used to update a cooperative sort,
the actions of the two other classes of priorities do have a biological meaning.
%by representing different reaction rates.
Indeed, they have been derived given the different reaction rates,
given the fact that the switches of genes $a$ and $c$ have to alternate in order not to miss a stripe.

\begin{figure}[p]
  \centering
  \scalebox{1}{
  \begin{tikzpicture}
    \TSort{(0,4)}{c}{2}{l}
    \TSort{(1,1)}{f}{2}{l}
    \TSort{(6,4)}{a}{2}{r}

    \TSetTick{fc}{0}{00}
    \TSetTick{fc}{1}{01}
    \TSetTick{fc}{2}{10}
    \TSetTick{fc}{3}{11}
    \TSort{(4,1)}{fc}{4}{r}
    
    \THit{fc_2}{prio}{a_0}{.west}{a_1}
    \path[bounce, bend left]
      \TBounce{a_0}{prio}{a_1}{.south west};
    
    \THit{c_1}{prio}{a_1}{.west}{a_0}
    \path[bounce, bend right]
      \TBounce{a_1}{prio}{a_0}{.north west};
    
    \THit{f_1}{bend left=30, in=90}{c_0}{.west}{c_1}
    \path[bounce, bend left]
      \TBounce{c_0}{}{c_1}{.south west};
    
    \THit{c_1}{selfhit}{c_1}{.west}{c_0}
    \path[bounce, bend right]
      \TBounce{c_1}{}{c_0}{.north west};
    
    \path (1.8, 1.5) edge[superprio,coopupdate] (3.2, 2);
    \path (0.8, 4.5) edge[superprio,coopupdate] (3.2, 3);
  \end{tikzpicture}
  }
  \caption{
  \label{fig:metazoan-php}
    An example of PH $\oPH$ with $3$ classes of priorities,
    modelling the process of metazoan segmentation.
    Actions of $\ov{\PHh}^{(3)}$ (lowest priority) are in thin lines,
    actions of $\ov{\PHh}^{(2)}$ (intermediate priority) are in thick lines,
    and actions of $\ov{\PHh}^{(1)}$ (highest priority), whose only purpose is to update the cooperative sort $fc$,
    are not represented but modelled by the double dashed arrows.
  }
\end{figure}

\begin{table}[p]
\modMF{
\begin{align*}
  \PHh^{(1)} = \{ \quad
    & \PHfrappe{f_1}{fc_{00}}{fc_{10}} \quad , \quad
    \PHfrappe{f_1}{fc_{01}}{fc_{11}} \quad , \\
    & \PHfrappe{f_0}{fc_{10}}{fc_{00}} \quad , \quad
    \PHfrappe{f_0}{fc_{11}}{fc_{01}} \quad , \\
    & \PHfrappe{c_1}{fc_{00}}{fc_{01}} \quad , \quad
    \PHfrappe{c_1}{fc_{10}}{fc_{11}} \quad , \\
    & \PHfrappe{c_0}{fc_{01}}{fc_{00}} \quad , \quad
    \PHfrappe{c_0}{fc_{11}}{fc_{10}}
  \quad \} \\
  \PHh^{(2)} = \{ \quad
    & \PHfrappe{c_1}{a_1}{a_0} \quad , \quad
    \PHfrappe{fc_{10}}{a_0}{a_1}
  \quad \} \\
  \PHh^{(3)} = \{ \quad
    & \PHfrappe{c_1}{c_1}{c_0} \quad , \quad
    \PHfrappe{f_1}{c_0}{c_1}
  \quad \} \\
\end{align*}%
}%
  \caption{\label{tab:metazoan-php-actions}%
    Sets of actions of the metazoan segmentation model depicted
    in \pref{fig:metazoan-php}.
  }
\end{table}

\pref{fig:metazoan-ph} gives the flattening of this model,
\modMF{
whose actions are detailed in \pref{tab:metazoan-ph-actions}.
}%
It contains $2$ classes of priority, and prioritised actions are only used to update cooperative sorts.
Note that according to the simplifications mentioned at the end of \pref{ssec:flattening},
the auto-action $h_1 = \PHhit{c_1}{c_1}{c_0}$ in $\oPH$ has been flattened to a regular action $\PHhit{a_0}{c_1}{c_0}$
because its playability property could be simplified to $\Fop{h_1} \equiv c_1 \wedge a_0 \equiv a_0$.

The static analysis results of \pref{ssec:ua} and \pref{ssec:ordered-ua} can be used to check if the model is functional, \ie
if genes $a$ and $c$ are successively activated and deactivated,
thus leading to the formation of regular stripes.
Starting from context $\ctx = \PHstate{f_1, a_0, c_0}$,
we want to check the reachability of
$\w = \PHobj{a_0}{a_1} \PHconcat \PHobj{c_0}{c_1} \PHconcat \PHobj{a_1}{a_0} \PHconcat \PHobj{c_1}{c_0}$.
Rather than checking this whole objective sequence,
we decompose it into the following ones:
\begin{align*}
  \ctx^1 &= \PHstate{f_1, a_0, c_0} \text{ and } P_1 = \PHobj{a_0}{a_1} &
  \ctx^3 &= \PHstate{f_1, a_1, c_1} \text{ and } P_2 = \PHobj{a_1}{a_0} \\
  \ctx^2 &= \PHstate{f_1, a_1, c_0} \text{ and } P_3 = \PHobj{c_0}{c_1} &
  \ctx^4 &= \PHstate{f_1, a_0, c_1} \text{ and } P_4 = \PHobj{c_1}{c_0}
\end{align*}
Given \pref{th:approxinf}, we have: $\forall i \in \segm{1}{4}, \muconcr_{\ctx^i}(P_i) \neq \emptyset$.
Finally, after checking that it can be applied for $i = 3$ down to $i = 1$,
\pref{thm:ordered-ua} gives: $\uconcr(\w) \neq \emptyset$.
Thus the model is functional.

\todo{Le résultat peut être raffiné avec l'atteignabilité successive}

\begin{figure}[p]
  \centering
  \scalebox{1}{
  \begin{tikzpicture}
    \TSort{(-5,4)}{c}{2}{l}
    \TSort{(0,1)}{f}{2}{l}
    \TSort{(5,4)}{a}{2}{r}

    \TSetTick{fc}{0}{00}
    \TSetTick{fc}{1}{01}
    \TSetTick{fc}{2}{10}
    \TSetTick{fc}{3}{11}
    \TSort{(3,0)}{fc}{4}{r}
    
    \TSetTick{fa}{0}{00}
    \TSetTick{fa}{1}{01}
    \TSetTick{fa}{2}{10}
    \TSetTick{fa}{3}{11}
    \TSort{(-3,0)}{fa}{4}{l}
    
    \THit{fc_2}{}{a_0}{.west}{a_1}
    \path[bounce, bend left]
      \TBounce{a_0}{}{a_1}{.south west};
    
    \THit{fa_3}{}{c_0}{.east}{c_1}
    \path[bounce, bend right]
      \TBounce{c_0}{}{c_1}{.south east};
    
    \THit{c_1.north east}{}{a_1}{.west}{a_0}
    \path[bounce, bend right]
      \TBounce{a_1}{}{a_0}{.north west};
    
    \THit{a_0.south west}{}{c_1}{.east}{c_0}
    \path[bounce, bend left]
      \TBounce{c_1}{}{c_0}{.north east};
    
    \path (0.8, 1.5) edge[prio,coopupdate] (2.2, 1.5);
    \path (-4.3, 4.5) edge[prio,coopupdate] (2.2, 2.5);
    
    \path (-0.8, 1.5) edge[prio,coopupdate] (-2.2, 1.5);
    \path (4.3, 4.5) edge[prio,coopupdate] (-2.2, 2.5);
  \end{tikzpicture}
  }
  \caption{
  \label{fig:metazoan-ph}
    An example of PH $\PH$ with $2$ classes of priorities,
    which is the flattening of the PH in \pref{fig:metazoan-php}.
    Actions of $\PHh^{(2)}$ (unprioritised) are in thin lines,
    and actions of $\PHh^{(1)}$ (prioritised) which are used to update cooperative sorts,
    are abstracted by thick dashed arrows.
  }
\end{figure}

\begin{table}[p]
\modMF{
\begin{align*}
  \PHh^{(1)} = \{ \quad
    & \PHfrappe{f_1}{fc_{00}}{fc_{10}} \quad , \quad
    \PHfrappe{f_1}{fc_{01}}{fc_{11}} \quad , \\
    & \PHfrappe{f_0}{fc_{10}}{fc_{00}} \quad , \quad
    \PHfrappe{f_0}{fc_{11}}{fc_{01}} \quad , \\
    & \PHfrappe{c_1}{fc_{00}}{fc_{01}} \quad , \quad
    \PHfrappe{c_1}{fc_{10}}{fc_{11}} \quad , \\
    & \PHfrappe{c_0}{fc_{01}}{fc_{00}} \quad , \quad
    \PHfrappe{c_0}{fc_{11}}{fc_{10}} \quad , \\
    & \PHfrappe{f_1}{fa_{00}}{fa_{10}} \quad , \quad
    \PHfrappe{f_1}{fa_{01}}{fa_{11}} \quad , \\
    & \PHfrappe{f_0}{fa_{10}}{fa_{00}} \quad , \quad
    \PHfrappe{f_0}{fa_{11}}{fa_{01}} \quad , \\
    & \PHfrappe{a_1}{fa_{00}}{fa_{01}} \quad , \quad
    \PHfrappe{a_1}{fa_{10}}{fa_{11}} \quad , \\
    & \PHfrappe{a_0}{fa_{01}}{fa_{00}} \quad , \quad
    \PHfrappe{a_0}{fa_{11}}{fa_{10}}
  \quad \} \\
  \PHh^{(2)} = \{ \quad
    & \PHfrappe{c_1}{a_1}{a_0} \quad , \quad
    \PHfrappe{fc_{10}}{a_0}{a_1} \quad , \\
    & \PHfrappe{a_0}{c_1}{c_0} \quad , \quad
    \PHfrappe{fa_{11}}{c_0}{c_1}
  \quad \}
\end{align*}%
}%
  \caption{\label{tab:metazoan-ph-actions}%
    Sets of actions of the flattened metazoan segmentation model depicted
    in \pref{fig:metazoan-ph}.
  }
\end{table}



\subsection{Large-scale Application: T-cell receptor}

In order to support the scalability and applicability of our under-approximation of reachability, we
apply our new approach for the analysis of large-scale model of the T-cell receptor (TCR)
signalling pathway \cite{tcrsig94}.
This model gathers 94 interacting components and is specified as a Boolean network.
The under-approximation presented in this paper has been implemented in the existing Pint
software\footnote{Pint is freely available at \url{http://loicpauleve.name/pint}.}.

The Boolean model has been automatically encoded into a Process Hitting with 2 classes of priority%
\footnote{Files are available at
\url{http://maxime.folschette.name/underapprox-tcrsig94.zip}.}.
Then, we verified the reachability for the independent activation of 4 outputs of the signalling
cascade (SRE, AP1, NFkB, NFAT) from all possible input combinations (CD4, CD28, TCRlig) using our
new reachability under-approximation (answering either \emph{yes} or \emph{inconclusive}) and a 
previously defined reachability over-approximation \cite{PMR12-MSCS} (answering either \emph{no} or
\emph{inconclusive}).
All result in conclusive decisions, and the under-approximation has been satisfied in 12 cases (over
32) proving the satisfiability of the concerned reachability property in the encoded Boolean network
(and non-satisfiability in the other cases).

Computations times are in the order of a few hundredths of a second on a 2.4GHz processor with 2GB
of RAM.
To give a comparison, we did the same experiments with a standard symbolic model-checker, libDDD
\cite{libddd}, known for its good performances, the input model being the Boolean network expressed
as a Petri net.
However, due to the large scale of the model, the program runs out of memory for all the experiments.

While ensuring a low complexity for the analysis of reachability in Boolean and discrete networks, our
under-approximation method reveals to be conclusive in numerous cases when applied to real
large-scale biological models, which were not tractable with exact model-checking.

